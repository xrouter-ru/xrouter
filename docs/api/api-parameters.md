# XRouter API Parameters

## Sampling Parameters

### Temperature
- Key: `temperature`
- Тип: float
- Диапазон: [0.0, 2.0]
- По умолчанию: 1.0

Влияет на разнообразие ответов модели. Низкие значения делают ответы более предсказуемыми, высокие - более разнообразными. При 0 модель всегда дает одинаковый ответ на одинаковый ввод.

### Top P (Nucleus Sampling)
- Key: `top_p`
- Тип: float
- Диапазон: [0.0, 1.0]
- По умолчанию: 1.0

Ограничивает выбор токенов процентом вероятности. Модель выбирает только из токенов, чьи вероятности в сумме дают P. Работает как динамический Top K.

### Top K
- Key: `top_k`
- Тип: integer
- Диапазон: [0, ∞)
- По умолчанию: 0

Ограничивает выбор модели K наиболее вероятными токенами. При значении 1 модель всегда выбирает самый вероятный токен.

### Frequency Penalty
- Key: `frequency_penalty`
- Тип: float
- Диапазон: [-2.0, 2.0]
- По умолчанию: 0.0

Штраф за повторение токенов из входного текста. Штраф пропорционален частоте появления токена.

### Presence Penalty
- Key: `presence_penalty`
- Тип: float
- Диапазон: [-2.0, 2.0]
- По умолчанию: 0.0

Штраф за повторение любых токенов из входного текста. Штраф не зависит от частоты появления.

### Repetition Penalty
- Key: `repetition_penalty`
- Тип: float
- Диапазон: [0.0, 2.0]
- По умолчанию: 1.0

Помогает уменьшить повторения. Штраф основан на исходной вероятности токена.

### Min P
- Key: `min_p`
- Тип: float
- Диапазон: [0.0, 1.0]
- По умолчанию: 0.0

Минимальная вероятность для рассмотрения токена относительно наиболее вероятного.

### Top A
- Key: `top_a`
- Тип: float
- Диапазон: [0.0, 1.0]
- По умолчанию: 0.0

Рассматривает только токены с "достаточно высокой" вероятностью относительно максимальной.

## Контроль генерации

### Seed
- Key: `seed`
- Тип: integer
- По умолчанию: null

Позволяет получать детерминированные результаты. При одинаковом seed и параметрах результат должен быть одинаковым.

### Max Tokens
- Key: `max_tokens`
- Тип: integer
- Диапазон: [1, context_length - prompt_length]
- По умолчанию: Зависит от модели

Максимальное количество токенов в ответе.

### Logit Bias
- Key: `logit_bias`
- Тип: map
- Диапазон значений: [-100, 100]

Позволяет влиять на вероятность выбора конкретных токенов.

### Response Format
- Key: `response_format`
- Тип: object
- Формат:
```typescript
{
  type: "json_object" | "text"
}
```

Принудительное форматирование ответа в JSON или текст.

## Ограничения моделей

### GigaChat
```typescript
interface GigaChatLimits {
  context_length: 4096;
  max_tokens: 4096;
  supported_features: ["streaming", "function-calling"];
}
```

### Yandex GPT
```typescript
interface YandexGPTLimits {
  context_length: 8192;
  max_tokens: 8192;
  supported_features: ["streaming"];
}
```

### MTS AI
```typescript
interface MTSLimits {
  context_length: 4096;
  max_tokens: 4096;
  supported_features: ["function-calling"];
}
```

### T-Bank
```typescript
interface TBankLimits {
  context_length: 4096;
  max_tokens: 4096;
  supported_features: ["streaming"];
}
```

## Поддержка параметров провайдерами

| Параметр | GigaChat | Yandex GPT | MTS AI | T-Bank |
|----------|----------|------------|---------|---------|
| temperature | ✓ | ✓ | ✓ | ✓ |
| top_p | ✓ | ✓ | ✓ | ✓ |
| top_k | ✗ | ✓ | ✓ | ✓ |
| frequency_penalty | ✓ | ✗ | ✗ | ✗ |
| presence_penalty | ✓ | ✗ | ✗ | ✗ |
| repetition_penalty | ✗ | ✓ | ✓ | ✓ |
| min_p | ✗ | ✓ | ✗ | ✗ |
| top_a | ✗ | ✓ | ✗ | ✗ |
| seed | ✓ | ✓ | ✗ | ✗ |
| json_mode | ✓ | ✓ | ✗ | ✗ |
| function_call | ✓ | ✗ | ✓ | ✗ |

## Обработка неподдерживаемых параметров

1. Если провайдер не поддерживает параметр:
   - Параметр игнорируется
   - Предупреждение не выдается
   - Запрос обрабатывается с оставшимися параметрами

2. Если установлен `provider.require_parameters: true`:
   - Запрос будет маршрутизирован только провайдерам, поддерживающим все указанные параметры
   - При отсутствии таких провайдеров вернется ошибка 503

## Рекомендации по использованию

1. Temperature vs Top-P
   - Для творческих задач: высокая temperature (0.7-1.0)
   - Для фактических задач: низкая temperature (0.1-0.3)
   - Top-P лучше работает для контроля разнообразия

2. Penalties
   - Frequency penalty для уменьшения тематических повторов
   - Presence penalty для уменьшения дословных повторов
   - Repetition penalty для общего контроля повторений

3. Streaming
   - Включайте для интерактивных интерфейсов
   - Отключайте для batch-обработки
   - Поддерживается не всеми провайдерами

4. Function Calling
   - Используйте для структурированных ответов
   - Проверяйте поддержку провайдером
   - Тестируйте на различных сценариях