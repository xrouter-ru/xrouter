# XRouter: Маршрутизатор для российских LLM

**XRouter** — это современный веб-сервис, предлагающий унифицированный API для взаимодействия с различными российскими языковыми моделями (LLM). Сервис упрощает интеграцию с крупными LLM, такими как GigaChat, Yandex GPT, MTS AI и GEN-T, обеспечивая стандартный интерфейс, интеллектуальную маршрутизацию запросов и управление доступом.

Цель XRouter — стать универсальной точкой доступа к ведущим российским языковым решениям, позволяя разработчикам быстро и легко использовать их потенциал в своих приложениях.

---

## Основной функционал (MVP)

### 1. Интеграция с российскими LLM
XRouter поддерживает крупнейших российских провайдеров языковых моделей:
   - **GigaChat** — языковая модель от Сбербанка
   - **Yandex GPT** — модель от Яндекса
   - **MTS AI** — решение от МТС
   - **GEN-T** — модель от Тинькофф Банка

В перспективе планируется добавление новых провайдеров по мере их появления на рынке.

### 2. Унифицированный API
   - **Единый формат** запросов и ответов независимо от провайдера
   - **Автоматическое управление аутентификацией** через адаптеры API
   - Поддержка различных сценариев использования: 
     - Генерация текста (completion) 
     - Ведение диалогов (chat)
     - Создание эмбеддингов (embeddings)

### 3. Интеллектуальная маршрутизация
   - Автоматический выбор оптимального провайдера с учетом:
     - Производительности
     - Доступности сервиса
     - Стоимости использования
   - **Фейловер** — автоматическое переключение на резервного провайдера в случае сбоя
   - **Балансировка нагрузки** для оптимального распределения запросов

### 4. Мониторинг и аналитика
   - Отслеживание текущего состояния LLM провайдеров
   - Сбор метрик (время ответа, доступность, использование токенов)
   - Логирование всех запросов и их результатов

### 5. Управление доступом
- Гибкая система API-ключей
- Лимиты и квоты на основании подписки
- Прозрачный контроль использования для каждого клиента

---

## Перспективы и расширение функций 

### Расширение списка провайдеров
   - Подключение специализированных LLM (например, для финансов, медицины, права)
   - Интеграция с кастомными (корпоративными) моделями клиентов

### Умная маршрутизация
   - Использование машинного обучения для адаптивной маршрутизации запросов
   - Анализ производительности (скорости, качества) для выбора лучшего провайдера под задачу
   - Поддержка мультимодельного ансамбля (одновременное использование нескольких моделей)

### Расширение API
   - Поддержка потоковой генерации ответов (streaming)
   - Асинхронные запросы для длительных операций
   - Возможность пакетной обработки большого числа запросов (batch)

### Инструменты для разработчиков
   - SDK (Node.js, Python, Java, Go) для простоты интеграции
   - Интерактивный playground для тестирования API
   - Встроенные средства отладки

---

## Технологический стек

### Backend
- **Node.js** (Express.js + TypeScript) — главная серверная платформа
- **PostgreSQL** — основная СУБД для хранения клиентов и логов
- **Redis** — кэширование и управление токенами
- **Prometheus/Grafana** — система мониторинга и визуализации данных

### Архитектура
- Модульная структура с адаптерами для провайдеров
- API Gateway (на основе Nginx) для входных запросов с поддержкой балансировки
- Интеграция с внешними LLM через их официальные API

### Безопасность
- Шифрование данных (TLS, AES)
- Авторизация через JWT
- Соответствие законодательству РФ о персональных данных (152-ФЗ)

---

## Архитектура взаимодействия

**Общий процесс:**
1. Клиент отправляет запрос через API Gateway.
2. XRouter обрабатывает запрос и выбирает подходящий LLM-провайдер.
3. Запрос преобразуется провайдер-адаптером в нужный формат.
4. Ответ от провайдера возвращается клиенту через унифицированный формат.

**Компоненты:**
- **API Gateway**: управление запросами, авторизация, балансировка нагрузки.
- **Router Service**: алгоритмы маршрутизации и fallback стратегий.
- **Provider Adapters**: модули коннекторов, специфичных для каждого провайдера.
- **Monitoring Service**: сбор метрик, контроль состояния системы.

---

## Примеры запросов

**Пример чат-комплишена:**
```json
POST /v1/chat/completions
{
  "model": "mts-ai",
  "messages": [
    {"role": "user", "content": "Привет! Расскажи, что нового?"}
  ],
  "temperature": 0.7,
  "max_tokens": 200
}
```

**Пример ответа:**
```json
{
  "id": "response-123",
  "choices": [
    {
      "message": {
        "role": "assistant",
        "content": "Привет! У меня всё отлично, рад быть полезным. Чем могу помочь?"
      },
      "finish_reason": "stop"
    }
  ]
}
```

---

## Уникальные преимущества XRouter

1. **Локализация**: Адаптирован под ключевые российские технологические платформы и особенности.
2. **Единая интеграция**: Один API вместо множества, даже при подключении новых провайдеров.
3. **Гибкость маршрутизации**: Интеллектуальный выбор на основе производительности и задач.
4. **Простота интеграции**: Оптимальные инструменты для разработчиков (SDK, playground, документация).
5. **Соответствие требованиям**: Полное соблюдение российского законодательства в области работы с данными.